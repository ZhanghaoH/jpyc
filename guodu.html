<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">
    <link rel="stylesheet" type="text/css" href="https://res.wx.qq.com/open/libs/weui/0.4.1/weui.css">
    <title>实名认证</title>
    <script src="./assets/js/handlebars.min.js"></script>
    <style>
        .weui-cell {
            padding: 10px 15px;
            position: relative;
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            align-items: center;
        }

        .weui-cell__bd {
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            flex: 1;
        }

        .weui-cell__ft {
            text-align: right;
            color: #808080;
        }
    </style>
</head>

<body>
    <!-- <div class="weui_msg">
        <div class="weui_icon_area">
            <i class="weui_icon_info weui_icon_msg"></i>
        </div>
        <div class="weui_text_area">
            <h4 class="weui_msg_title">认证出错</h4>
        </div>
        <div class="weui_icon_area">
            <i class="weui_icon_success weui_icon_msg"></i>
        </div>
        <div class="weui_text_area">
            <h4 class="weui_msg_title">认证成功</h4>
        </div>
        <div class="weui_icon_area">
            <i class="weui_icon_warn weui_icon_msg"></i>
        </div>
        <div class="weui_text_area">
            <h4 class="weui_msg_title">认证失败</h4>
        </div>
    </div>
    <div class="weui-cells">
        <div class="weui-cell">
            <div class="weui-cell__bd">
                <p>标题文字</p>
            </div>
            <div class="weui-cell__ft">说明文字</div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__bd">
                <p>标题文字</p>
            </div>
            <div class="weui-cell__ft">说明文字</div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__bd">
                <p>标题文字</p>
            </div>
            <div class="weui-cell__ft">说明文字</div>
        </div>
    </div> -->
</body>
<script id="tpl" type="text/x-handlebars-template">
    {{#if resultData}} {{#resultData}}
    <div class="weui_msg">
        <!-- <div class="weui_icon_area">
            <i class="weui_icon_info weui_icon_msg"></i>
        </div>
        <div class="weui_text_area">
            <h4 class="weui_msg_title">认证出错</h4>
        </div> -->
        <div class="weui_icon_area">
            <i class="weui_icon_success weui_icon_msg"></i>
        </div>
        <div class="weui_text_area">
            <h4 class="weui_msg_title">认证成功</h4>
        </div>
        <!-- <div class="weui_icon_area">
            <i class="weui_icon_warn weui_icon_msg"></i>
        </div>
        <div class="weui_text_area">
            <h4 class="weui_msg_title">认证失败</h4>
        </div> -->
    </div>
    <div class="weui-cells">
        <div class="weui-cell">
            <div class="weui-cell__bd">
                <p>身份证号</p>
            </div>
            <div class="weui-cell__ft">{{id}}</div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__bd">
                <p>姓名</p>
            </div>
            <div class="weui-cell__ft">{{name}}</div>
        </div>
    </div>
    {{/resultData}} {{else}}
    <div class="weui_msg">
        <div class="weui_icon_area">
            <i class="weui_icon_warn weui_icon_msg"></i>
        </div>
        <div class="weui_text_area">
            <h4 class="weui_msg_title">认证失败</h4>
        </div>
    </div>
    {{/if}}
</script>
<script src="./assets/js/jquery.min.js"></script>
<script>
    $(function () {
        // alert("http://app1.henanga.gov.cn/zzga-wx-server/truename/saveAuthInfo" + window.location.search)
        // {
        //     "resultData": {
        //         "id": "410184199302277612",
        //         "name": "张浩",
        //         "unionId": "xxxxx"
        //     },
        //     "errCode": "0",
        //     "msg": "认证成功！"
        // }
        //  0 成功 1 失败  10 系统错误
        let tplScript = $("#tpl").html()
        let tpl = Handlebars.compile(tplScript)
        let unionId =window.localStorage.getItem("unionId")
        $.ajax({
            type: "POST",
            url: "https://app1.henanga.gov.cn/zzga-wx-server/truename/saveAuthInfo" + location.search,
            // dataType: "JSON",
            success: function (response) {
                alert("enter")
                // alert(JSON.parse(response))
                console.log(response);
                let compiledTpl = tpl(response)
                window.localStorage.setItem("uData", JSON.stringify(response.resultData))
                $("body").html(compiledTpl)
                // let errCode = response.errCode
                // switch (errCode) {
                //     case "0":

                //         break;
                //     case "1":

                //         break;
                //     case "10":
                //     default:

                //         break;
                // }
                // $("body").html(JSON.stringify(response))
            },
            error: function error(err) {
                alert(err)
                console.log(err);
                document.head.innerHTML =
                    '<title>抱歉，出错了</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0"><link rel="stylesheet" type="text/css" href="https://res.wx.qq.com/open/libs/weui/0.4.1/weui.css">';
                document.body.innerHTML =
                    '<div class="weui_msg"><div class="weui_icon_area"><i class="weui_icon_info weui_icon_msg"></i></div><div class="weui_text_area"><h4 class="weui_msg_title">服务器开小差了，请稍候再试</h4></div></div>';
            },
            complete: function complete(XMLHttpRequest, status) {
                //请求完成后最终执行参数
                if (status == 'timeout') {
                    //超时,status还有success,error等值的情况
                    ajaxTimeoutTest.abort();
                    document.head.innerHTML =
                        '<title>抱歉，出错了</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0"><link rel="stylesheet" type="text/css" href="https://res.wx.qq.com/open/libs/weui/0.4.1/weui.css">';
                    document.body.innerHTML =
                        '<div class="weui_msg"><div class="weui_icon_area"><i class="weui_icon_info weui_icon_msg"></i></div><div class="weui_text_area"><h4 class="weui_msg_title">请求超时</h4></div></div>';
                }
            }
        });
        // window.location.assign("http://app1.henanga.gov.cn/zzga-wx-server/truename/saveAuthInfo" + window.location.search)

    })
</script>

</html>