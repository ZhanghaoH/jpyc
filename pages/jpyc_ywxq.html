<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>业务详情</title>
    <link rel="stylesheet" href="../assets/css/x-reset.css">
    <link rel="stylesheet" href="../assets/css/jpyc_ywxq.css">
    <script src="../assets/js/jquery.min.js"></script>
    <script src="../assets/js/urlHead.js"></script>
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?095edfec21fc74ce77584243f9070933";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
    <script src="../assets/js/browser.js"></script>
    <script src="../assets/js/handlebars.min.js"></script>
</head>

<body>
    <img src="../assets/i_jpyc/jpyc_slogan4.jpg" class="img-slogan img-block" alt="就跑一次">
    <div class="container">
    </div>
    <div class="btn-wr">
        <!-- <a class="btn-option" href="tel:0371-86580228">电话咨询</a>
        <a class="btn-option hide" href="http://zzga.ueit.com.cn/orderAPI.php">预约</a>
        <a class="btn-option" href="http://ldrk.henanga.gov.cn/weixin/gaLdrk/t.do?">申报</a> -->
    </div>
    <script id="tplServiceDetail" type="text/x-handlebars-template">
        {{#resultData}}
        <!-- <div class="container"> -->
        <div class="item-tit">{{regname}}</div>
        <div>
            <div class="item__label">办理依据</div>
            <div>{{{dealdep}}}</div>
        </div>
        <div>
            <div class="item__label">办理条件</div>
            <div>{{{dealcond}}}</div>
        </div>
        <div>
            <div class="item__label">办理流程</div>
            <div>{{{dealpro}}}</div>
        </div>
        <div class="item__mark">
            <div class="item-name">办理期限：</div>
            <div class="item-cnt">{{{dealtime}}}</div>
            <i class="item-icon icon-ddline"></i>
        </div>
        <div class="item__mark">
            <div class="item-name">收费标准：</div>
            <div class="item-cnt">{{{chargestad}}}</div>
            <i class="item-icon icon-fee"></i>
        </div>
        {{#if ../bljg.wadress}}
        <div class="item__mark">
            <div class="item-name">办理地址：</div>
            <div class="item-cnt">{{{../bljg.wadress}}}</div>
            <i class="item-icon icon-addr"></i>
        </div>
        {{/if}}
        <div class="item__mark">
            <div class="item-name">工作时间：</div>
            <div class="item-cnt">{{{accepttime}}}</div>
            <i class="item-icon icon-time"></i>
        </div>
        {{#if ../bljg.wtelphone}}
        <div class="item__mark">
            <div class="item-name">固定电话：</div>
            <div class="item-cnt">
                <a href="tel:0371-{{../bljg.wtelphone}}">0371-{{../bljg.wtelphone}}</a>
            </div>
            <i class="item-icon icon-tel"></i>
        </div>
        {{/if}}
        {{#if ../bljg.wpolicephone}}
        <div class="item__mark">
            <div class="item-name">移动电话：</div>
            <div class="item-cnt">
                <a href="tel:13809784638">{{../bljg.wpolicephone}}</a>
            </div>
            <i class="item-icon icon-mobile"></i>
        </div>
        {{/if}}
        <!-- </div> -->
        {{/resultData}}
    </script>
</body>
<script>
    $(function() {
        let tplServiceDetailScript = $("#tplServiceDetail").html()
        let tplServiceDetail = Handlebars.compile(tplServiceDetailScript)

        // let areaId = window.localStorage.getItem("areaId") || ""
        let categoryId = window.localStorage.getItem("categoryId")
        let ywtypeId = window.localStorage.getItem("ywtypeId")
        let bljg = new Object()
        if(window.localStorage.hasOwnProperty("bljg")){
            let bljgString = window.localStorage.getItem("bljg")
            console.log(bljgString);
            bljg = JSON.parse(bljgString)
        }
        console.log(bljg);
        // console.log(areaId);

        let registerId = GetUrlParam("itemId") //无参数或不存在指定key 则返回一个对象包含所有参数键值
        console.log(registerId); //registerId 事项id
        let unionId = window.localStorage.getItem("unionId")
            // 小程序码显示
        var timer;
        $("body").on("touchend", ".btn-mdmzx", function() {
            $("body").find(".xcx-box").show()
            clearTimeout(timer);
            $(".xcx-box").show(0, function() {
                timer = setTimeout(() => {
                    $(".xcx-box").hide()
                    window.location.assign('../pages/jpyc_feedback.html?')
                }, 10000);
            });
        });
        // 小程序码隐藏
        $("body").on("touchend", ".xcx-box .close", function() {
            // clearTimeout(timer);
            $("body").find(".xcx-box").hide();
        });

        function GetUrlParam(paraName) {　　　　
            var url = document.location.toString();　　　　
            var arrObj = url.split("?");
            var paramsObj = new Object()　　　　
            if (arrObj.length > 1) {　　　　　　
                var arrPara = arrObj[1].split("&");　　　　　　
                var arr;

                for (var i = 0; i < arrPara.length; i++) {　　　　　　　　
                    arr = arrPara[i].split("=");
                    // console.log(arr);
                    paramsObj[arr[0]] = arr[1]　　　　　　　　
                    if (arr != null && arguments.length > 0 && arr[0] == paraName) {　　　　　　　　　　
                        return arr[1];　　　　　　　　
                    }　　　　　　
                }
                return paramsObj
            }　　　　
        }

        var ajaxTimeoutTest = $.ajax({
            type: "get",
            url: URLHEAD_JPYC + jpyc_ywxq,
            data: {
                registerId: registerId
            },
            timeout: 5000,
            success: function success(res) {
                console.log(res);
                let errCode = res.code
                if (errCode == "0") {
                    res.bljg = bljg
                    let compiledTpl = tplServiceDetail(res)
                    $(".container").html(compiledTpl)
                    let resData = res.resultData
                    let state = resData.state
                    let btnGroupHtml = ''
                        // 1 公示 2 咨询 3 预约  4 咨询和预约 5 咨询申报
                    let vcode = categoryId + "-" + ywtypeId + "-" + bljg.areaId +
                        "-" + bljg.wicketId
                        // let vcode = resData.categoryId + "-" + resData.ywtypeId + "-" + bljg.areaId + "-" + bljg.id + "-" + response.itemId
                    console.log(vcode);
                    // 1-2-1-1-50  1-2-1-8-50 3-10-2-218-94 3-11-1-193-43 4-13-1-195-42
                    switch (state) {
                        case 1:
                            // break;
                        case 2:
                            if (vcode == "1-2-1-1" || vcode == "1-2-1-8" || vcode == "3-10-2-218" ||
                                vcode == "3-11-1-193" || vcode == "4-13-1-195") {
                                let pname = ""
                                switch (vcode) {
                                    case "1-2-1-1":
                                        pname = "1-2-1-1-50"
                                        break;
                                    case "1-2-1-8":
                                        pname = "1-2-1-8-50"
                                        break;
                                    case "3-10-2-218":
                                        pname = "3-10-2-218-94"
                                        break;
                                    case "3-11-1-193":
                                        pname = "3-11-1-193-43"
                                        break;
                                    case "4-13-1-195":
                                        pname = "4-13-1-195-42"
                                        break;

                                    default:
                                        break;
                                }
                                btnGroupHtml =
                                    `<a class="btn-option btn-mdmzx" href="javascript:;">面对面咨询</a>`
                                let vcodeHtml =
                                    `<div class="xcx-box">
                                                <i class="close"></i>
                                                <div class="code-img">
                                                    <img src="../assets/i_vcode/${pname}.jpg" alt="">
                                                </div>
                                                <p class="xcx-text">长按识别二维码，进入视频咨询</p>
                                            </div>`
                                $("body").append(vcodeHtml)
                            } else {
                                btnGroupHtml =
                                    `<a class="btn-option" href="tel:${bljg.wtelphone}">电话咨询</a>`
                            }
                            break;
                        case 3:
                            btnGroupHtml =
                                `<a class="btn-option" href="http://zzga.ueit.com.cn/orderAPI.php?categoryId=${categoryId}&ywtypeId=${ywtypeId}&departmentId=${bljg.wicketId}&itemId=${registerId}&unionId=${unionId}" >预约</a>`
                            break;
                        case 4:
                            if (vcode == "1-2-1-1" || vcode == "1-2-1-8" || vcode == "3-10-2-218" ||
                                vcode == "3-11-1-193" || vcode == "4-13-1-195") {
                                let pname = ""
                                switch (vcode) {
                                    case "1-2-1-1":
                                        pname = "1-2-1-1-50"
                                        break;
                                    case "1-2-1-8":
                                        pname = "1-2-1-1-8"
                                        break;
                                    case "3-10-2-218":
                                        pname = "3-10-2-218-94"
                                        break;
                                    case "3-11-1-193":
                                        pname = "3-11-1-193-43"
                                        break;
                                    case "4-13-1-195":
                                        pname = "4-13-1-195-42"
                                        break;

                                    default:
                                        break;
                                }
                                btnGroupHtml =
                                    `<a class="btn-option btn-mdmzx" href="javascript:;">面对面咨询</a>`
                                let vcodeHtml =
                                    `<div class="xcx-box">
                                                <i class="close"></i>
                                                <div class="code-img">
                                                    <img src="../assets/i_vcode/${pname}.jpg" alt="">
                                                </div>
                                                <p class="xcx-text">长按识别二维码，进入视频咨询</p>
                                            </div>`
                                $("body").append(vcodeHtml)
                            } else {
                                btnGroupHtml =
                                    `<a class="btn-option" href="tel:${bljg.wtelphone}">电话咨询</a>`
                            }
                            btnGroupHtml +=
                                `<a class="btn-option" href="http://zzga.ueit.com.cn/orderAPI.php?categoryId=${categoryId}&ywtypeId=${ywtypeId}&departmentId=${bljg.wicketId}&itemId=${registerId}&unionId=${unionId}">预约</a>`
                            break;
                        case 5:
                            if (vcode == "1-2-1-1" || vcode == "1-2-1-8" || vcode == "3-10-2-218" ||
                                vcode == "3-11-1-193" || vcode == "4-13-1-195") {
                                let pname = ""
                                switch (vcode) {
                                    case "1-2-1-1":
                                        pname = "1-2-1-1-50"
                                        break;
                                    case "1-2-1-8":
                                        pname = "1-2-1-8-50"
                                        break;
                                    case "3-10-2-218":
                                        pname = "3-10-2-218-94"
                                        break;
                                    case "3-11-1-193":
                                        pname = "3-11-1-193-43"
                                        break;
                                    case "4-13-1-195":
                                        pname = "4-13-1-195-42"
                                        break;

                                    default:
                                        break;
                                }
                                btnGroupHtml =
                                    `<a class="btn-option btn-mdmzx" href="javascript:;">面对面咨询</a>`
                                let vcodeHtml =
                                    `<div class="xcx-box">
                                                <i class="close"></i>
                                                <div class="code-img">
                                                    <img src="../assets/i_vcode/${pname}.jpg" alt="">
                                                </div>
                                                <p class="xcx-text">长按识别二维码，进入视频咨询</p>
                                            </div>`
                                $("body").append(vcodeHtml)
                            } else {
                                btnGroupHtml =
                                    `<a class="btn-option" href="tel:${bljg.wtelphone}">电话咨询</a>`
                            }
                            btnGroupHtml +=
                                `<a class="btn-option" href="http://ldrk.henanga.gov.cn/weixin/gaLdrk/t.do?categoryId=${categoryId}&ywtypeId=${ywtypeId}&departmentId=${bljg.wicketId}&itemId=${registerId}&unionId=${unionId}">申报</a>`
                            break;

                        default:
                            break;
                    }
                    $(".btn-wr").html(btnGroupHtml)
                } else {
                    document.head.innerHTML =
                        '<title>抱歉，出错了</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0"><link rel="stylesheet" type="text/css" href="https://res.wx.qq.com/open/libs/weui/0.4.1/weui.css">';
                    document.body.innerHTML =
                        '<div class="weui_msg"><div class="weui_icon_area"><i class="weui_icon_info weui_icon_msg"></i></div><div class="weui_text_area"><h4 class="weui_msg_title">' +
                        response.msg + '</h4></div></div>';
                }
            },
            error: function error(err) {
                console.log(err);
                document.head.innerHTML =
                    '<title>抱歉，出错了</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0"><link rel="stylesheet" type="text/css" href="https://res.wx.qq.com/open/libs/weui/0.4.1/weui.css">';
                document.body.innerHTML =
                    '<div class="weui_msg"><div class="weui_icon_area"><i class="weui_icon_info weui_icon_msg"></i></div><div class="weui_text_area"><h4 class="weui_msg_title">服务器开小差了，请稍候再试</h4></div></div>';
            },
            complete: function complete(XMLHttpRequest, status) {
                //请求完成后最终执行参数
                if (status == 'timeout') {
                    //超时,status还有success,error等值的情况
                    ajaxTimeoutTest.abort();
                    document.head.innerHTML =
                        '<title>抱歉，出错了</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0"><link rel="stylesheet" type="text/css" href="https://res.wx.qq.com/open/libs/weui/0.4.1/weui.css">';
                    document.body.innerHTML =
                        '<div class="weui_msg"><div class="weui_icon_area"><i class="weui_icon_info weui_icon_msg"></i></div><div class="weui_text_area"><h4 class="weui_msg_title">请求超时</h4></div></div>';
                }
            }
        });
    })
</script>

</html>